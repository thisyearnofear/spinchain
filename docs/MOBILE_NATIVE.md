# SpinChain: Mobile Native App Strategy

## Overview

This document outlines the strategy for adding native mobile app support to SpinChain via Capacitor, enabling full Bluetooth Low Energy (BLE) functionality on iOS and Android devices.

---

## Current State: Web Bluetooth Limitations

### What's Built
- Full BLE stack using Web Bluetooth API
- Device memory for quick reconnect
- Works on Chrome Desktop, Edge Desktop

### Browser Limitations
| Browser | BLE Support | Notes |
|---------|-------------|-------|
| Chrome Desktop | ✅ Full | Works great |
| Safari macOS | ❌ None | No Web Bluetooth |
| Safari iOS 16+ | ⚠️ Partial | Limited support |
| Chrome Android | ⚠️ Partial | Varies by device |
| Firefox Mobile | ❌ None | No Web Bluetooth |

### The Problem
**Web Bluetooth API** doesn't have consistent mobile support. This limits the "wow factor" of connecting real Schwinn/Bowfix bikes on phones.

---

## Solution: Capacitor Hybrid App

### What is Capacitor?
- Open-source native runtime from Ionic
- Wraps web apps in native containers
- Provides native APIs (Bluetooth, Camera, Push Notifications)
- Single codebase → iOS + Android + Web

### Benefits
| Benefit | Impact |
|---------|--------|
| **Full BLE** | Native Bluetooth = reliable iOS/Android |
| **Better Performance** | 3D runs smoother in native WebView |
| **Push Notifications** | Class reminders, achievements |
| **Offline Mode** | Cache routes, workout plans |
| **App Store Presence** | Credibility, discoverability |

---

## Implementation Plan

### Phase 1: Setup Capacitor (1-2 days)
```bash
# Install Capacitor
npm install @capacitor/core @capacitor/cli

# Add platforms
npx cap add ios
npx cap add android

# Install BLE plugin
npm install @capacitor-community/bluetooth-le
```

### Phase 2: Create Native Bridge (2-3 days)
- Wrap existing `BleService` with Capacitor BLE plugin
- Create `@spinchain/mobile-bridge` module
- Falls back to Web Bluetooth on desktop

### Phase 3: App Configuration (1 day)
- App icons, splash screens
- Push notification setup
- App Store metadata

### Phase 4: Testing & Deploy (2-3 days)
- Test on real iOS/Android devices
- Submit to App Store / Play Store

---

## Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                     SpinChain App                          │
├─────────────────────────────────────────────────────────────┤
│  UI Layer (React)                                          │
│  ├── RouteVisualizer                                       │
│  ├── DeviceSelector ←── Enhanced with native BLE           │
│  └── RidePage                                              │
├─────────────────────────────────────────────────────────────┤
│  Bridge Layer (@spinchain/mobile-bridge)                  │
│  ├── useNativeBle() ←── Capacitor BLE plugin              │
│  └── useNativeStorage()                                   │
├─────────────────────────────────────────────────────────────┤
│  Platform Detection                                        │
│  ├── web → Web Bluetooth API (desktop)                   │
│  ├── ios → @capacitor-community/bluetooth-le            │
│  └── android → @capacitor-community/bluetooth-le          │
└─────────────────────────────────────────────────────────────┘
```

---

## Code Example: Native BLE Bridge

```typescript
// lib/mobile-bridge/ble.ts
import { BleClient } from '@capacitor-community/bluetooth-le';

class NativeBleService {
  async scanAndConnect(): Promise<BleDevice> {
    // Native BLE - works on iOS/Android
    const device = await BleClient.requestDevice({
      services: ['18018', '180D'], // Power, HR services
    });
    await device.connect();
    return this.parseDevice(device);
  }
}

// Auto-detect platform
const bleService = 
  isMobile() 
    ? new NativeBleService() 
    : new WebBleService();
```

---

## Hybrid Strategy: Best of Both Worlds

### User Flow
```
1. User visits spinchain.com in browser
   ↓
2. Browse classes, view routes, see pricing
   ↓
3. "Download App" prompt for full experience
   ↓
4. Native app: Real BLE + 3D + Offline
   ↓
5. Browser: Discovery, sharing (works without app)
```

### Feature Matrix
| Feature | Web | Native App |
|---------|-----|------------|
| Browse Classes | ✅ | ✅ |
| View Routes | ✅ | ✅ |
| Purchase Tickets | ✅ | ✅ |
| Real BLE Data | ⚠️ Partial | ✅ Full |
| 3D Visualization | ⚠️ Desktop | ✅ |
| Push Notifications | ❌ | ✅ |
| Offline Mode | ❌ | ✅ |

---

## Files to Create

```
docs/
└── MOBILE_NATIVE.md (this file)

app/
└── lib/
    └── mobile-bridge/
        ├── ble.ts          # Native BLE wrapper
        ├── storage.ts      # Native storage
        └── notifications.ts # Push notifications

capacitor/                  # Generated by Capacitor
├── capacitor.config.ts
├── ios/
└── android/
```

---

## Cost/Benefit Analysis

### Development Time
- **Capacitor Setup**: 1-2 days
- **BLE Bridge**: 2-3 days  
- **Testing/Deploy**: 2-3 days
- **Total**: ~1 week

### Ongoing Maintenance
- Share ~90% code between web + native
- Update both stores on release

### ROI
- Unlocks ~40% more users (mobile BLE)
- App Store presence for credibility
- Push notifications → higher retention

---

## Alternatives Considered

### 1. React Native (Instead of Capacitor)
- More native control
- But: Separate codebases, more work
- **Verdict**: Capacitor is better for "web-first" apps

### 2. PWA (Progressive Web App)
- Works offline
- But: Still has BLE limitations
- **Verdict**: Good supplement, not replacement

### 3. Stay Web-Only
- Cheapest option
- But: Compromised mobile experience
- **Verdict**: Not competitive with Peloton/Zwift

---

## Next Steps

1. **Install Capacitor** in the project
2. **Create native bridge** for BLE
3. **Test on real devices**
4. **Submit to stores**

---

## Resources

- [Capacitor Docs](https://capacitorjs.com/docs)
- [Capacitor BLE Plugin](https://github.com/capacitor-community/bluetooth-le)
- [Ionic Framework](https://ionicframework.com)

---

## Questions?

- Q: Can users still use the web app?  
  A: Yes! The native app enhances rather than replaces.

- Q: Do we lose web functionality?  
  A: No - both work. Web is discovery, app is experience.

- Q: How much extra work?  
  A: ~1 week for full implementation.

- Q: What about the existing web app?  
  A: It continues to work - just enhanced by the native app.
